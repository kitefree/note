

## 常規效能測試

軟體在正常的軟硬體環境下進行，不向其施加任何壓力的效能測試。這裡所說的正常環境一般指使用者實際使用的普通環境，並模擬生產執行的業務壓力。





## 可靠性測試(Reliability Testing)

在給被測系統載入一定業務壓力的情況下，使系統執行一段時間，以此來測試系統是否穩定。



## 壓力測試 (Stress Testing)

> 首先，壓力測試(Stress Testing)是什麼？簡單來說就是不斷的給予目標施加壓力，直到目標系統癱瘓，進而得知目標系統能承受的最大壓力。換句話說，壓力測試的目的即是在於找出『**在什麼狀態下，系統效能無法繼續接受**』。

> 是指不斷地給被測系統增加壓力，直到被測系統被壓垮，從而確定系統能承受的最大壓力。它實際上是通過對系統不斷施壓，來確定系統瓶頸或不能接受使用者請求的效能點，以獲得系統能提供的最大服務級別。換句話說，壓力測試就是為了發現什麼條件下系統效能變得不可接受。

>壓力測試試圖打破系統，在極端工作負載條件下測試系統行為。



## 壓力測試的基本觀念

- 排除頻寬的限制
  - 做壓力測試通常不會考量「頻寬的限制」，所以一般來說不會將測試的主機擺在遠端機房、然後測試程式擺在公司內部的主機，而是會將壓力測試的 Client 跟 Web 主機擺在同一個網段下進行壓力測試。
  - 因為「頻寬」只要花錢就會有了，但是主機的承載量卻是有限的，從遠端進行壓力測試主要的限制是在「頻寬」而非「效能」，所以從遠端單點進行壓力測試毫無任何意義可言，這樣是測不出主機的效能極限的。
  - 如果你有能力與資源進行大規模（多點）壓力測試的話，透過遠端進行壓力測試才有意義。
- 壓力要循序漸進
  - 你不要一下字就執行同時連線數 100 人，而是要循序漸進的慢慢加同時連線數上去，才不會讓 Web Application 一下字承受過大的負載而導致效能的數據不正確（例如說 Failed requests 過高），但這只是建議，你也可以一下子操死你的主機，反正你在測主機的極限嘛！

## 負載測試 (Load Testing)

> 舉個簡單的例子來解釋負載測試：A購物網最多可以讓500個人同時在線上購物，那麼我們讓A網站持續維持在500人同時購物的狀態，無異常的狀況下持續運作能達到多久來測試該站的穩定性。用意則是找出系統極限，為優化該站收集資料。

> 通常是讓被測系統在其能忍受的壓力極限範圍內（或臨界狀態下）連續執行，來測試系統的穩定性。其目的是找到系統的處理極限，為系統調優提供依據。

> 負載測試不會破壞系統，在正常工作負載條件下測試系統行為。



## 效能測試 (Performance Testing)

最後，效能測試(Load Testing)是什麼？在這邊我們不需用長篇大論的深度探討，直接以負載測試中的A購物網來解釋，即是當這500人同時在線上購物時，系統反應時間是否能夠滿足需求定義時間？一般來說，使用者能接受的底限大約落在2-3秒左右，一但超過這個時間使用者很容易就直接走人。



> 假設張三很輕鬆就可以扛一袋米，扛兩袋米很吃力，最多能扛三袋米，則：
>
> 常規效能測試：讓張三扛1袋米。
> 壓力測試：讓張三扛1袋米、2袋米、3袋米、4袋米，直至其被壓垮，並得出結論，張三最多隻能扛3袋米。
> 負載測試：讓張三扛2袋米，然後去操場跑圈，看他多久能累倒。
> 可靠性測試：讓張三扛1袋米，然後去操場跑圈，看他多久能累倒。



## 耐力測試/浸泡測試 (Endurance Testing/Soak Testing)

在預期的最大負荷下長時間的運行應用程式，確保應用程式能夠運作。
通常因為系统運行時間過長，一些資源無法正常釋放，導致系统回應的時間慢慢變長。

- **耐力測試/浸泡測試的目的：**

  - 監視資料庫資源的消耗 (是否正常的清除不必要的資料)
  - 監視服務器資源的消耗 (有就是很常聽到的 CPU 使用率）

- 舉個例子

  > 在一整個學年度中，每個老師每天都狂出作業跟考試。 (聽起來是預期的XD)
  > 你就像是應用程式，必須長時間處理預期的最大負荷。
  > 而老師就是那個測試人員，他必須確定你不會無故請假或是翹課。
  > 也要監督你的學業成績不會下滑，必須能夠有效地吸收老師教的東西。





## 體積測試/洪水測試 (Volume Testing)

將大量的數據寫入資料庫中，並監控整個系統的行為，確保應用程式能夠運作。

- **體積測試/洪水測試的目的：**

  - 通過增加資料庫中的數據量來檢查系統性能。
  - 識別大量數據可能發生的問題。
  - 釐清系統穩定性降低的問題點。
  - 確定應用程式正常和大量的容量。

- 舉個例子

  > 在上英文課的時候，老師都會固定教 10 個單字，並在下次上課考試。
  > 但是某天，老師突然教了 100 個單字，並且下次上課也要考試。
  > 此時 100 個單字就有如大量的數據，學生的腦力就有如資料庫。
  > 確保學生是否可以有效吸收這 100 個單字的內容。



擴展性測試/伸縮性測試 (Scalability Testing)

確定系統在擴展中的有效性，以支持用戶負載的增加，有助於規劃軟體系統容量增加。
用於在按比例放大或縮小用戶請求時測量網絡或系統的性能。

- **擴展性測試/伸縮性測試的目的：**

  - 確保應用程序可以處理預計的用戶流量，數據量，事務計數頻率等方面的增長
  - 確定應用程式的用戶限制。
  - 確定負載下的客戶端降級和最終用戶體驗。
  - 確定服務器端的健壯性和降級。

- 舉個例子

  > 在學期剛開始的時候，老師教的東西都較簡單也較少。
  > 但是隨著時間的增加，老師所教的內容越來越艱深也越來越難懂。
  > 而老師就是那個測試人員，確保學生可以處理預期的課程內容。
  > 而學生也必須能夠隨著課程難度的提升而有所成長。



## 尖峰測試 (Spike Testing)

尖峰測試是從電力工業借鑒而來的，測試設備剛接通電源時，能否承受住通流的破壞。
而軟體的衝擊測試，是為了驗證網站在用户突然急速增加的情况下能夠正常工運行。

- 舉個例子

  > 還沒到上下個得期間，學校附近的交通都非常的順暢。
  > 但是一到上下課的時間一到，大量的交通工具，一窩蜂的聚集在一起。
  > 此時學校就會關注，家長的接送率，學校內部的接送區，與內部停車場的使用率。
  > 就像是在關注 CPU 使用率、可用内存、内存使用百分比等。
  > 每隔一時間就紀錄上述的指標，來確定系統的問題之處。





## 性能測試的步驟

以下內容為性能測試的基本步驟，如果對性能測試的步驟毫無頭緒，可以參考看看。

1. 確定測試環境

   > 了解所需測試的環境。(通常與穩定的版本環境相似)
   > 了解可用的測試工具，或是可用的測試設備。
   > 使用的軟硬體和網絡配置的詳細信息。

2. 確定性能驗收標準

   > 確認性能測試所要關注的主要內容。(包括吞吐量，響應時間和資源分配等)
   > 還有必要在這些目標和約束之外確定項目成功標準。

3. 計畫和設計性能測試

   > 確定最終用戶的使用情況，可能會有所不同。
   > 確定測試所有可能案例的關鍵方案。
   > 模擬各種終端用戶的使用情境。
   > 規劃性能測試數據並概述將收集哪些指標。

4. 配置測試環境

   > 執行前確保已準備測試環境，安排工具和其他資源。

5. 實施測試設計

   > 根據測試計畫與設計創建性能測試內容。

6. 運行測試

   > 執行並監控測試，確定測試正常運行。

7. 分析、調整和重新測試

   > 整合、分析和共享測試結果。
   > 進行微調並再次測試以確定性能是否有改善或降低。





## 壓力測試的步驟

（1）確定存量數據的規模（用戶一般會要求製造出3－5年的存量數據）；

（2）確定需要進行壓力測試的業務（一般是用戶使用最頻繁，或者業務操作複雜的業務）；

（3）確定操作用戶的的數量、各類操作用戶的比例；



（4）峰值業務量的要求（一般是1個小時內最多要處理的筆數）；

（5）對實時業務響應時間的要求（如在峰值情況下，單筆業務的處理時間（如小於60秒））；

（6）對於批量處理過程的時間要求（如進行日終（月終、年終）處理、與外系統間批量數據傳輸時的時間）。

以上信息，通常需要業務人員來確定。



為了進行壓力測試的技術準備，需要如下資料：

（1）系統概要設計（了解系統技術架構，確定測試方法）；

（2）如果自己開發接口程序，需要了解接口報文規範；

（3）資料庫設計（我們需要據此編寫程序，準備存量數據）。



為了開發腳本需要了解如下信息：

（1）操作手冊（腳本錄入或者手工開發腳本）；

（2）參數化腳本（動態化數據需要進行關聯）；

（3）腳本回放（驗證腳本是否可以成功的創建數據）。

測試場景：

（1）單用戶運行壓力測試場景；

（2）多用戶運行測試場景，查看系統資源消耗等調優工作開始。

另外，還有測試環境的事情需要落實。壓力測試一般要求環境配置較高，最好與生產環境一致或者接近。





場景設計

哪些業務需要做壓力測試？

比較常用業務場景(OR 功能模塊)

比方說瀏覽網頁業務量少，充值的網頁業務量特別多。就針對充值的網頁業務量進行測試

單業務場景/或者多業務場景

項目要求做的業務場景





## 吞吐率（Requests per second），缩写RPS



>吞吐率 = 总请求数 / 处理这些请求的总完成时间
>Requests per second = Complete requests / Time taken for tests

吞吐率是服务器并发处理能力的量化描述，单位是reqs/s，指的是某个并发用户数下单位时间内处理的请求数。
某个并发用户数下单位时间内能处理的最大的请求数，称之为`最大吞吐率`。



## QPS、每秒查询率（Query Per Second）

>qps = 请求查询数 / 秒
>qps = fetchs / per second

每秒查询率QPS是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。
在因特网上，作为域名系统服务器的机器的性能经常用每秒查询率来衡量。
qps相当于`最大吞吐率`。



軟體測試工具

JMeter

LoadRunner

Siege

TCPCopy





## jmeter 定時排程



![image](E:\kite_project\壓力測試\壓力測試 (Stress Testing).assets\1605887776-2721416704-g_n.png)

新增引數欄位就填寫： -n -t test1120.jmx -l test1120.csv -e -o report





## 參考連結

使用 ApacheBench 進行網站的壓力測試

https://blog.miniasp.com/post/2008/06/30/Using-ApacheBench-ab-to-to-Web-stress-test



How to stress test server memory and processor?

https://stackoverflow.com/questions/10548400/how-to-stress-test-server-memory-and-processor



淺談測試基本觀念 – 壓力測試、負載測試、效能測試

https://www.astralweb.com.tw/introduction-of-stress-testing-load-testing-and-performance-testing/



軟體測試員必知！壓力測試總共需要幾個步驟？思路總結篇

原文網址：https://kknews.cc/news/g9nak4e.html





系統壓力測試計畫-使用JMETER工具

https://www.tpisoftware.com/tpu/articleDetails/2293



吞吐率（Requests per second），缩写RPS

https://blog.csdn.net/beiniao520/article/details/80240974





Jmeter 压力测试并输出HTML报告

https://www.jianshu.com/p/4f32918d66bb



jmeter监控服务器cpu、内存等

https://www.huaweicloud.com/articles/9830ece7f98931e822e041e485067f66.html



JMeter Plugin 伺服器監控 (Servers Performance Monitor)

http://dog0416.blogspot.com/2019/08/jmeter-jmeter-plugin-servers.html



鼠年全馬鐵人挑戰 WEEK 05：軟體測試的種類 - 番外篇

https://ithelp.ithome.com.tw/articles/10230130



★★如何進行網站壓力測試：以不動產交易實價查詢服務網為例

https://blog.miniasp.com/post/2012/10/18/How-to-do-Web-Load-Test



How to stress test server memory and processor?

```
<?php
for($i = 0; $i < 1000000000; $i++) {
     $a += $i;
}
```



```
for($i = 0; $i < 9999; $i++) {
    $conn = mysql_connect(...);
    $db = mysql_select_db(...);
    $res = mysql_query(...);
    $data = mysql_fetch_assoc($res);
    mysql_close();
}
```

